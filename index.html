<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Red Beat</title>
    <style>
      body {
        margin: 0;
        background: #000;
        color: white;
        font-family: "Segoe UI", Tahoma, sans-serif;
        overflow: hidden;
      }
      #warningOverlay,
      #configScreen,
      #mainContent {
        position: fixed;
        inset: 0;
        display: none;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        text-align: center;
        padding: 2rem;
        background: #000;
      }
      #warningOverlay {
        display: flex;
        background: rgba(0, 0, 0, 0.98);
        z-index: 9999;
      }
      h1 {
        font-size: 3rem;
        color: #ff4e4e;
        animation: flicker 2s infinite;
        margin-bottom: 0.5rem;
      }
      h2 {
        margin-bottom: 1rem;
        font-weight: 600;
        font-size: 2rem;
        color: #00ffff;
        text-shadow: 0 0 10px #00ffffbb;
      }
      h3 {
        margin-top: 1.5rem;
        margin-bottom: 0.5rem;
        color: #00cccc;
        font-weight: 600;
      }
      p {
        max-width: 600px;
        margin: 0.5rem auto 1rem;
        font-size: 1.1rem;
        color: #ccc;
      }
      button {
        padding: 15px 30px;
        font-size: 1.2rem;
        background: linear-gradient(145deg, #111111, #222222);
        border: none;
        border-radius: 12px;
        color: #00ffff;
        cursor: pointer;
        transition: 0.3s;
        box-shadow: 0 0 15px #00ffffbb;
        font-weight: 600;
        user-select: none;
      }
      button:hover {
        background: linear-gradient(145deg, #222222, #111111);
        transform: scale(1.05);
        box-shadow: 0 0 25px #00ffffee;
      }
      input[type="number"],
      input[type="text"] {
        width: 100%;
        padding: 10px;
        margin-top: 4px;
        margin-bottom: 15px;
        background: #111;
        border: 1px solid #00cccc;
        border-radius: 8px;
        color: #00ffff;
        font-size: 1rem;
        box-shadow: inset 0 0 5px #00cccc88;
        transition: border-color 0.3s ease;
      }
      input[type="number"]:focus,
      input[type="text"]:focus {
        border-color: #00ffff;
        outline: none;
        box-shadow: 0 0 8px #00ffffcc;
      }
      label {
        display: flex;
        align-items: center;
        gap: 10px;
        cursor: pointer;
        font-size: 1.1rem;
        color: #00cccc;
        user-select: none;
      }
      label input[type="checkbox"] {
        width: 20px;
        height: 20px;
        accent-color: #00ffff;
        cursor: pointer;
      }
      .config-section {
        margin-top: 1rem;
        width: 100%;
        max-width: 500px;
        background: #111;
        border-radius: 15px;
        padding: 20px 25px;
        box-shadow: 0 0 25px #00cccc44;
      }
      #configScreen {
        display: flex;
        overflow-y: auto;
        -webkit-overflow-scrolling: touch;
      }
      /* Scrollbar styling for modern browsers */
      #configScreen::-webkit-scrollbar {
        width: 10px;
      }
      #configScreen::-webkit-scrollbar-thumb {
        background: #00cccc88;
        border-radius: 10px;
      }
      #configScreen::-webkit-scrollbar-track {
        background: #111;
      }
      @keyframes flicker {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.5;
        }
      }
      #light {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        background: #111;
        box-shadow: 0 0 8px rgba(0, 255, 255, 0.1);
        opacity: 0.2;
        margin-bottom: 15px;
        transition: opacity 0.3s ease;
      }
      img {
        max-width: 95%;
        max-height: 95vh;
        border-radius: 8px;
        box-shadow: 0 0 60px rgba(255, 255, 255, 0.05);
        transition: transform 0.3s ease;
      }
      .pulse {
        animation: pulse 0.3s ease-in-out;
      }
      .wobble {
        animation: wobble 0.3s ease-in-out;
      }
      .image-wobble {
        animation: image-wobble 0.3s ease-in-out;
      }
      @keyframes pulse {
        0%,
        100% {
          background: #111;
          box-shadow: 0 0 10px rgba(0, 255, 255, 0.2);
        }
        50% {
          background: #222;
          box-shadow: 0 0 20px rgba(0, 255, 255, 0.4);
        }
      }
      @keyframes wobble {
        0%,
        100% {
          transform: rotate(0);
        }
        25% {
          transform: rotate(1deg);
        }
        50% {
          transform: rotate(-1deg);
        }
        75% {
          transform: rotate(0.5deg);
        }
      }
      @keyframes image-wobble {
        0%,
        100% {
          transform: scale(1) rotate(0deg);
        }
        25% {
          transform: scale(1.01) rotate(0.3deg);
        }
        50% {
          transform: scale(0.99) rotate(-0.3deg);
        }
        75% {
          transform: scale(1.005) rotate(0.15deg);
        }
      }
    </style>
  </head>
  <body>
    <audio id="clickSound" src="click.mp3" preload="auto"></audio>

    <div id="warningOverlay">
      <h1>⚠️ 18+ Warning</h1>
      <p>
        This site contains fictional, mature, and potentially disturbing
        content.<br /><br />
        By clicking "Enter", you confirm you are 18+ and agree to view this
        content.
      </p>
      <button id="enterButton">Enter</button>
    </div>

    <div id="configScreen">
      <div class="config-section">
        <h2>Game Configuration</h2>

        <label for="communityInput"
          >Enter subreddit names (comma separated):</label
        >
        <input
          type="text"
          id="communityInput"
          value="PantiesHentai,UpskirtHentai,PokemonFeetHentai,BestHentaiFeet,Smelly_Hentai_Feet,HentaiCumsluts"
          autocomplete="off"
        />

        <h3>Enable Game Events</h3>
        <label
          ><input
            type="checkbox"
            class="event-checkbox"
            value="doublestrokes"
            checked
          />
          Double Strokes</label
        >
        <label
          ><input
            type="checkbox"
            class="event-checkbox"
            value="halvedstrokes"
            checked
          />
          Halved Strokes</label
        >
        <label
          ><input
            type="checkbox"
            class="event-checkbox"
            value="teasingstrokes"
            checked
          />
          Teasing Strokes</label
        >
        <label
          ><input
            type="checkbox"
            class="event-checkbox"
            value="accelerationcycles"
            checked
          />
          Acceleration Cycles</label
        >
        <label
          ><input
            type="checkbox"
            class="event-checkbox"
            value="randombeats"
            checked
          />
          Random Beats</label
        >
        <label
          ><input
            type="checkbox"
            class="event-checkbox"
            value="randomstrokespeed"
            checked
          />
          Random Stroke Speed</label
        >
        <label
          ><input
            type="checkbox"
            class="event-checkbox"
            value="redlightgreenlight"
            checked
          />
          Red Light Green Light</label
        >
        <label
          ><input
            type="checkbox"
            class="event-checkbox"
            value="clusterstrokes"
            checked
          />
          Cluster Strokes</label
        >
        <label
          ><input
            type="checkbox"
            class="event-checkbox"
            value="gripchallenge"
            checked
          />
          Grip Challenge</label
        >

        <h3>Stroke Speed (BPS)</h3>
        <label>
          Min:
          <input type="number" id="minBps" value="1" step="0.1" min="0.1" />
        </label>
        <label>
          Max:
          <input type="number" id="maxBps" value="3" step="0.1" min="0.1" />
        </label>

        <h3>Duration between events (seconds)</h3>
        <input type="number" id="eventDuration" value="15" step="1" min="5" />

        <h3>Image display duration (seconds)</h3>
        <input type="number" id="imageDuration" value="10" step="1" min="3" />

        <button id="startGame">Start Game</button>
      </div>
    </div>

    <div id="mainContent">
      <div id="light"></div>
      <img id="image" src="" alt="Loading..." />
    </div>

    <script>
      const $ = (id) => document.getElementById(id);
      const imageEl = $("image");
      const lightEl = $("light");
      const clickSound = $("clickSound");

      let communities = [];
      const viewedImages = new Set();
      let minBps = 1;
      let maxBps = 3;
      let bps = 1;

      let metronomeRunning = true;
      let lastBeatTime = performance.now();

      let eventCount = 0;
      let gameStartTime = null;
      let endMode = false;
      let eventIntervalId = null;
      let imageTimeoutId = null;

      function animatePulse() {
        lightEl.classList.add("pulse", "wobble");
        imageEl.classList.add("image-wobble");
        clickSound.currentTime = 0;
        clickSound.play().catch(() => {});
        setTimeout(() => {
          lightEl.classList.remove("pulse", "wobble");
          imageEl.classList.remove("image-wobble");
        }, 300);
      }

      function metronomeLoop(now) {
        if (!metronomeRunning || bps <= 0) {
          return requestAnimationFrame(metronomeLoop);
        }

        const interval = 1000 / bps;
        if (now - lastBeatTime >= interval) {
          animatePulse();
          lastBeatTime = now;
        }

        requestAnimationFrame(metronomeLoop);
      }

      function setBps(value) {
        bps = Math.max(0, Math.min(10, value));
      }

      function getRandomBps() {
        return minBps + Math.random() * (maxBps - minBps);
      }

      function fetchImage(retryCount = 0) {
        if (communities.length === 0) return;

        const subreddit =
          communities[Math.floor(Math.random() * communities.length)];
        fetch(`https://www.reddit.com/r/${subreddit}/.json?limit=50`, {
          headers: { "User-Agent": "Mozilla/5.0" },
        })
          .then((res) => res.json())
          .then((data) => {
            let posts = data.data.children
              .map((p) => p.data.url)
              .filter((url) => /\.(jpg|jpeg|png|gif)$/i.test(url))
              .map((url) => url.replace(".gifv", ".gif"))
              .filter((url) => !viewedImages.has(url));

            if (posts.length > 0) {
              const url = posts[Math.floor(Math.random() * posts.length)];
              imageEl.src = url;
              viewedImages.add(url);
              if (viewedImages.size > 100) viewedImages.clear();
            } else if (retryCount < 3) {
              setTimeout(() => fetchImage(retryCount + 1), 1000);
            }
          })
          .catch(() => {
            if (retryCount < 3) {
              setTimeout(() => fetchImage(retryCount + 1), 1000);
            }
          });
      }

      const notif = document.createElement("div");
      notif.style.cssText = `
      position: fixed; top: 20px; left: 50%; transform: translateX(-50%);
      padding: 10px 20px; background: #222; border: 2px solid #555; color: #0ff;
      font-size: 1.1rem; border-radius: 8px; opacity: 0; transition: opacity 0.3s ease;
      user-select: none;
      z-index: 9999;
    `;
      document.body.appendChild(notif);

      function showEventNotification(text) {
        notif.textContent = `⚡ Event: ${text}`;
        notif.style.opacity = "1";
        setTimeout(() => (notif.style.opacity = "0"), 7000);
      }

      const gameEvents = {
        doublestrokes: () => {
          showEventNotification("🔁 Double Strokes!");
          let originalBps = bps;
          setBps(bps * 2);
          setTimeout(() => setBps(originalBps), 10000);
        },

        halvedstrokes: () => {
          showEventNotification("⏬ Halved Strokes!");
          let originalBps = bps;
          setBps(bps / 2);
          setTimeout(() => setBps(originalBps), 10000);
        },

        teasingstrokes: () => {
          showEventNotification("😈 Teasing Strokes!");
          metronomeRunning = false;
          setTimeout(() => (metronomeRunning = true), 8000);
        },

        accelerationcycles: () => {
          showEventNotification("🚀 Acceleration Cycles!");
          let cycleCount = 0;
          const maxCycles = 6;
          const accelInterval = setInterval(() => {
            if (cycleCount >= maxCycles) {
              clearInterval(accelInterval);
              setBps(minBps);
              return;
            }
            setBps(minBps + (maxBps - minBps) * (cycleCount / maxCycles));
            cycleCount++;
          }, 1000);
        },

        randombeats: () => {
          showEventNotification("🎵 Random Beats!");
          const randomBps = getRandomBps();
          setBps(randomBps);
          setTimeout(() => setBps((minBps + maxBps) / 2), 10000);
        },

        randomstrokespeed: () => {
          showEventNotification("⚡ Random Stroke Speed!");
          const interval = setInterval(() => {
            if (!metronomeRunning) return;
            setBps(getRandomBps());
          }, 1000);
          setTimeout(() => {
            clearInterval(interval);
            setBps((minBps + maxBps) / 2);
          }, 10000);
        },

        redlightgreenlight: () => {
          showEventNotification("🚦 Red Light Green Light!");
          metronomeRunning = false;
          setTimeout(() => (metronomeRunning = true), 8000);
        },

        clusterstrokes: () => {
          showEventNotification("🔹 Cluster Strokes!");
          let count = 0;
          const clusterInterval = setInterval(() => {
            animatePulse();
            count++;
            if (count > 10) {
              clearInterval(clusterInterval);
            }
          }, 200);
        },

        gripchallenge: () => {
          showEventNotification("✊ Grip Challenge!");
          // Grip challenge logic here (if desired)
        },
      };

      function runRandomEvent(enabledEvents) {
        if (enabledEvents.length === 0) return;
        const eventName =
          enabledEvents[Math.floor(Math.random() * enabledEvents.length)];
        if (gameEvents[eventName]) gameEvents[eventName]();
      }

      function startEventLoop(eventDuration, imageDuration, enabledEvents) {
        gameStartTime = performance.now();
        eventCount = 0;
        endMode = false;

        function nextEvent() {
          if (endMode) return;

          runRandomEvent(enabledEvents);
          fetchImage();

          clearTimeout(imageTimeoutId);
          imageTimeoutId = setTimeout(fetchImage, imageDuration * 1000);

          eventCount++;

          if (eventCount >= 15) {
            endMode = true;
            setBps(maxBps);
            showEventNotification("Get ready!!!");

            setTimeout(() => {
              showEventNotification("FINISH!");
              setBps(maxBps*2);
              setTimeout(() => {
                setBps(minBps);
                showEventNotification("Thank you for playing, bye!");
              }, 10000);
            }, 17000);

            clearTimeout(imageTimeoutId);
            clearInterval(eventIntervalId);
          }
        }

        nextEvent();
        eventIntervalId = setInterval(nextEvent, eventDuration * 1000);
      }

      // Handling warning overlay & config screen
      $("enterButton").addEventListener("click", () => {
        $("warningOverlay").style.display = "none";
        $("configScreen").style.display = "flex";
      });

      $("startGame").addEventListener("click", () => {
        // Read communities
        const communityInput = $("communityInput").value;
        communities = communityInput
          .split(",")
          .map((c) => c.trim())
          .filter((c) => c.length > 0);

        if (communities.length === 0) {
          alert("Please enter at least one subreddit.");
          return;
        }

        // Read event checkboxes
        const checkboxes = document.querySelectorAll(".event-checkbox");
        const enabledEvents = [];
        checkboxes.forEach((cb) => {
          if (cb.checked) enabledEvents.push(cb.value);
        });

        // Read stroke speed range
        minBps = parseFloat($("minBps").value) || 1;
        maxBps = parseFloat($("maxBps").value) || 3;
        if (minBps > maxBps) {
          alert("Min BPS must be less than or equal to Max BPS.");
          return;
        }

        // Read durations
        const eventDuration = parseInt($("eventDuration").value) || 15;
        const imageDuration = parseInt($("imageDuration").value) || 10;

        // Hide config, show main content
        $("configScreen").style.display = "none";
        $("mainContent").style.display = "flex";

        // Initialize state
        setBps(minBps);
        metronomeRunning = true;

        fetchImage();
        startEventLoop(eventDuration, imageDuration, enabledEvents);
        requestAnimationFrame(metronomeLoop);
      });
    </script>
  </body>
</html>
